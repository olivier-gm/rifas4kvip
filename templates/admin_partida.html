<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/static/img/ico.png" type="image/x-icon">
    <title>Partida Admin ¬∑ Rifa 1</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #181818f5;
            color: #e9ecef;
            min-height: 100vh;
        }

        /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
        .admin-header {
            background-color: #212529;
            border-bottom: 2px solid #454d55;
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
        }

        .admin-header img {
            width: 36px;
            height: 36px;
            object-fit: contain;
        }

        .admin-header h1 {
            font-size: 1.15rem;
            font-weight: 700;
            margin: 0;
            color: #fff;
            letter-spacing: 0.4px;
        }

        .badge-admin {
            font-size: 0.68rem;
            background: #4caf50;
            color: #000;
            padding: 2px 8px;
            border-radius: 20px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        /* ‚îÄ‚îÄ Contenedor central ‚îÄ‚îÄ */
        .form-wrap {
            max-width: 520px;
            margin: 0 auto;
            padding: 0 16px 50px;
        }

        /* ‚îÄ‚îÄ Tarjeta de estado actual ‚îÄ‚îÄ */
        .status-card {
            background-color: #212529;
            border: 1px solid #454d55;
            border-radius: 10px;
            padding: 20px 22px;
            margin-bottom: 24px;
        }

        .status-card .card-title {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #6c757d;
            margin-bottom: 14px;
        }

        .status-card p {
            font-size: 0.9rem;
            color: #ced4da;
            margin-bottom: 8px;
            display: flex;
            gap: 6px;
        }

        .status-card p:last-child {
            margin-bottom: 0;
        }

        .status-card strong {
            color: #fff;
            min-width: 170px;
            display: inline-block;
        }

        .status-badge {
            display: inline-block;
            padding: 2px 10px;
            border-radius: 20px;
            font-size: 0.78rem;
            font-weight: 700;
            background: #4caf50;
            color: #000;
        }

        /* ‚îÄ‚îÄ Separador ‚îÄ‚îÄ */
        .section-label {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #6c757d;
            margin-bottom: 12px;
            margin-top: 4px;
        }

        /* ‚îÄ‚îÄ Botones de acci√≥n r√°pida (reiniciar / desplazar) ‚îÄ‚îÄ */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 22px;
        }

        .btn-quick {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.15s;
        }

        .btn-quick:hover {
            opacity: 0.85;
            transform: translateY(-1px);
        }

        .btn-reiniciar {
            background-color: #b45309;
            color: #fff;
        }

        .btn-desplazar {
            background-color: #374151;
            color: #e9ecef;
            border: 1px solid #454d55;
        }

        /* ‚îÄ‚îÄ Botones venta ‚îÄ‚îÄ */
        .venta-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-venta {
            flex: 1;
            padding: 11px;
            border: none;
            border-radius: 8px;
            font-size: 0.88rem;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.15s;
        }

        .btn-venta:hover {
            opacity: 0.85;
            transform: translateY(-1px);
        }

        .btn-start {
            background-color: #1565c0;
            color: #fff;
        }

        .btn-stop {
            background-color: #d32f2f;
            color: #fff;
        }

        /* ‚îÄ‚îÄ Inputs ‚îÄ‚îÄ */
        .form-group {
            margin-bottom: 14px;
        }

        .form-group label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: #6c757d;
            margin-bottom: 6px;
        }

        .form-group input,
        .form-group .form-control {
            width: 100%;
            padding: 10px 14px;
            font-size: 0.92rem;
            border: 1px solid #373b3e;
            border-radius: 8px;
            background-color: #212529;
            color: #e9ecef;
            outline: none;
            transition: border-color 0.18s;
        }

        .form-group input:focus,
        .form-group .form-control:focus {
            border-color: #4caf50;
            box-shadow: none;
        }

        .form-group input::placeholder {
            color: #555;
        }

        /* Input file */
        .form-group input[type="file"] {
            padding: 8px 10px;
            cursor: pointer;
        }

        /* Imagen actual */
        .current-img-wrap {
            text-align: center;
            margin-bottom: 18px;
        }

        .current-img-wrap p {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .current-img-wrap img {
            max-width: 50%;
            height: auto;
            border-radius: 10px;
            border: 1px solid #373b3e;
        }

        /* ‚îÄ‚îÄ Bot√≥n guardar ‚îÄ‚îÄ */
        .btn-submit {
            width: 100%;
            padding: 13px;
            background-color: #4caf50;
            color: #000;
            border: none;
            border-radius: 9px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.15s;
            margin-top: 4px;
        }

        .btn-submit:hover {
            background-color: #388e3c;
            transform: translateY(-1px);
        }

        hr.sep {
            border: none;
            border-top: 1px solid #2a2a2a;
            margin: 20px 0;
        }
    </style>
</head>

<body>

    <div class="admin-header">
        <img src="/static/img/ico.png" alt="Logo">
        <h1>Configuraci√≥n de Partida</h1>
        <span class="badge-admin">ADMIN ¬∑ RIFA 1</span>
    </div>

    <div class="form-wrap">

        <!-- Estado actual -->
        <div class="status-card">
            <div class="card-title">üìä Estado actual</div>
            <p><strong>Estado:</strong> <span class="status-badge">{{ datos[0] }}</span></p>
            <p><strong>Fecha de la rifa:</strong> {{ datos[1] }}</p>
            <p><strong>Premio:</strong> {{ datos[2] }}</p>
            <p><strong>Precio bol√≠vares:</strong> {{ datos[3] }} Bs</p>
            <p><strong>Precio zelle:</strong> {{ datos[4] }} $</p>
            <p><strong>Correo zelle:</strong> {{ datos[5] }}</p>
            <p><strong>M√≠nimo de tickets:</strong> {{ datos[6] }}</p>
        </div>

        <!-- Acciones r√°pidas -->
        <p class="section-label">Acciones de disponibilidad</p>
        <div class="quick-actions">
            <form action="/admin/dashboard/partida/reiniciar" method="POST" style="flex:1;margin:0;">
                <button type="submit" class="btn-quick btn-reiniciar w-100">üîÑ Reiniciar disponibilidad</button>
            </form>
            <form action="/admin/dashboard/partida/desplazar" method="POST" style="flex:1;margin:0;">
                <button type="submit" class="btn-quick btn-desplazar w-100">‚ÜîÔ∏è Desplazar</button>
            </form>
        </div>

        <!-- Formulario principal -->
        <form method="POST" enctype="multipart/form-data">

            <!-- Control de venta -->
            <p class="section-label">Control de venta</p>
            <div class="venta-actions">
                <button type="submit" class="btn-venta btn-start" name="action" value="Venta en curso">‚ñ∂Ô∏è Empezar
                    venta</button>
                <button type="submit" class="btn-venta btn-stop" name="action" value="Venta finalizada">‚èπ Finalizar
                    venta</button>
            </div>

            <hr class="sep">

            <!-- Imagen -->
            <div class="form-group">
                <label for="imagen">Subir imagen de portada</label>
                <input type="file" class="form-control" id="imagen" name="imagen" accept=".png,.jpg,.jpeg">
            </div>
            <div class="current-img-wrap">
                <p>Imagen actual</p>
                <img src="{{ url_for('static', filename='img/partida.jpg') }}" alt="Imagen actual">
            </div>

            <hr class="sep">

            <!-- Datos editables -->
            <p class="section-label">Datos de la rifa</p>

            <div class="form-group">
                <label for="fechaEnunciado">Fecha de la rifa</label>
                <input type="text" id="fechaEnunciado" name="fechaEnunciado" placeholder="Ej: 15/03/2025"
                    value="{{ datos[1] }}">
            </div>
            <div class="form-group">
                <label for="recompensa">Premio</label>
                <input type="text" id="recompensa" name="recompensa" placeholder="Describe el premio"
                    value="{{ datos[2] }}">
            </div>
            <div class="form-group">
                <label for="precioTicket">Precio del ticket (Bs)</label>
                <input type="number" id="precioTicket" name="precioTicket" placeholder="Precio en bol√≠vares"
                    value="{{ datos[3] }}">
            </div>
            <div class="form-group">
                <label for="precioTicketD">Precio del ticket ($)</label>
                <input type="number" id="precioTicketD" name="precioTicket$" placeholder="Precio en d√≥lares"
                    value="{{ datos[4] }}">
            </div>
            <div class="form-group">
                <label for="zelle">Correo Zelle</label>
                <input type="email" id="zelle" name="zelle" placeholder="correo@ejemplo.com" value="{{ datos[5] }}">
            </div>
            <div class="form-group">
                <label for="tipoTicket">Cantidad m√≠nima de tickets</label>
                <input type="number" min="30" max="9999" id="tipoTicket" name="tipoTicket"
                    placeholder="M√≠nimo permitido">
            </div>

            <button type="submit" class="btn-submit">üíæ Guardar cambios</button>
        </form>

        <!-- ‚îÄ‚îÄ Tickets Premiados ‚îÄ‚îÄ -->
        <hr class="sep" style="margin-top:28px;">
        <p class="section-label" style="margin-top:0;">üèÜ Tickets Premiados</p>

        <!-- Fila de agregar -->
        <div style="display:flex;gap:8px;margin-bottom:12px;align-items:flex-start;">
            <div style="flex:0 0 130px;">
                <label
                    style="font-size:0.7rem;color:#6c757d;font-weight:700;text-transform:uppercase;letter-spacing:.7px;display:block;margin-bottom:4px;">N¬∞
                    Ticket</label>
                <input type="number" id="premioNumero" min="1" max="1000000" placeholder="Ej: 1234"
                    style="width:100%;padding:9px 12px;background:#212529;border:1px solid #373b3e;border-radius:8px;color:#e9ecef;font-size:.88rem;outline:none;">
            </div>
            <div style="flex:1;">
                <label
                    style="font-size:0.7rem;color:#6c757d;font-weight:700;text-transform:uppercase;letter-spacing:.7px;display:block;margin-bottom:4px;">Valor
                    del premio</label>
                <input type="text" id="premioValor" placeholder="Ej: 300bs, iPhone 15‚Ä¶"
                    style="width:100%;padding:9px 12px;background:#212529;border:1px solid #373b3e;border-radius:8px;color:#e9ecef;font-size:.88rem;outline:none;">
            </div>
            <div style="flex:0 0 auto;padding-top:22px;">
                <button onclick="agregarPremio()" type="button"
                    style="padding:9px 16px;background:#4caf50;color:#000;border:none;border-radius:8px;font-weight:700;font-size:1rem;cursor:pointer;">Ôºã</button>
            </div>
        </div>
        <div id="premioError" style="color:#ef5350;font-size:0.8rem;margin-bottom:8px;display:none;"></div>

        <!-- Lista de tickets premiados -->
        <div id="premiosList" style="display:flex;flex-direction:column;gap:6px;margin-bottom:20px;">
            <p style="color:#555;font-size:0.85rem;" id="premiosEmpty">Cargando‚Ä¶</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-jBq8dLDry3nJ8tyDk5bxUQwF1XZUjZlZFS8SSek0bpKPIqjPY/z2QkI9rxfnzTMq"
        crossorigin="anonymous"></script>

    <script>
        document.getElementById('tipoTicket').addEventListener('change', function () {
            const extraInputContainer = document.getElementById('extraInputContainer');
            if (extraInputContainer) {
                extraInputContainer.style.display = this.value === '3z' ? 'block' : 'none';
            }
        });

        /* ‚îÄ‚îÄ Tickets Premiados ‚îÄ‚îÄ */
        async function cargarPremios() {
            const list = document.getElementById('premiosList');
            const empty = document.getElementById('premiosEmpty');
            const data = await fetch('/premios').then(r => r.json());

            list.innerHTML = '';
            if (data.length === 0) {
                list.innerHTML = '<p style="color:#555;font-size:0.85rem;">No hay tickets premiados configurados.</p>';
                return;
            }
            data.forEach(p => list.appendChild(premioRow(p)));
        }

        function premioRow(p) {
            const row = document.createElement('div');
            row.id = `premio-row-${p.numero}`;
            row.style.cssText = 'display:flex;align-items:center;gap:10px;background:#212529;border:1px solid #373b3e;border-radius:8px;padding:9px 12px;';
            row.innerHTML = `
                <span style="font-family:monospace;font-weight:700;color:#4caf50;min-width:52px;">${String(p.numero).padStart(4, '0')}</span>
                <span style="flex:1;color:#ced4da;font-size:.88rem;">${p.valor}</span>
                <span style="font-size:.75rem;color:${p.estado === 'tomado' ? '#ef9a9a' : '#6c757d'};">
                    ${p.estado === 'tomado' ? 'üë§ ' + p.ganador : '‚úÖ Libre'}
                </span>
                <button type="button" onclick="eliminarPremio(${p.numero}, this)"
                    style="background:#d32f2f;border:none;border-radius:6px;padding:4px 9px;color:#fff;font-size:.8rem;cursor:pointer;">üóë</button>`;
            return row;
        }

        async function agregarPremio() {
            const numInput = document.getElementById('premioNumero');
            const valInput = document.getElementById('premioValor');
            const errDiv = document.getElementById('premioError');
            const numero = parseInt(numInput.value);
            const valor = valInput.value.trim();

            errDiv.style.display = 'none';

            if (!numero || numero < 1 || numero > 1000000) {
                showError('El n√∫mero debe estar entre 1 y 1 000 000.');
                return;
            }
            if (!valor) { showError('El valor del premio no puede estar vac√≠o.'); return; }

            const res = await fetch('/admin/dashboard/premios/add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ numero, valor })
            });
            const data = await res.json();
            if (!data.success) { showError(data.message); return; }

            numInput.value = '';
            valInput.value = '';
            cargarPremios();
        }

        async function eliminarPremio(numero, btn) {
            btn.disabled = true;
            await fetch('/admin/dashboard/premios/delete', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ numero })
            });
            document.getElementById(`premio-row-${numero}`)?.remove();
            if (!document.getElementById('premiosList').children.length) {
                document.getElementById('premiosList').innerHTML =
                    '<p style="color:#555;font-size:0.85rem;">No hay tickets premiados configurados.</p>';
            }
        }

        function showError(msg) {
            const e = document.getElementById('premioError');
            e.textContent = msg;
            e.style.display = 'block';
        }

        cargarPremios();
    </script>
</body>

</html>